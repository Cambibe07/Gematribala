<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gematria The Cipher - Sacred Alchemy</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Quicksand:wght@300;500&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --gold: #b8860b;
            --ink: #1a1a1b;
            --parchment: #fdfcf0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--parchment);
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            color: var(--ink);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 850px;
            width: 100%;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            padding: clamp(20px, 5vw, 30px);
            border: 1px solid #e0d9b5;
            box-shadow: 0 10px 30px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: "";
            position: absolute;
            top: 50%; left: 50%; width: 120%; height: 120%;
            background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/Sigillum_Dei_Aemeth.svg/1024px-Sigillum_Dei_Aemeth.svg.png') no-repeat center;
            background-size: contain;
            opacity: 0.03;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 0;
        }

        .content-wrap { position: relative; z-index: 1; }

        h1 {
            font-family: 'Cinzel', serif;
            font-size: clamp(1.4rem, 4vw, 2.2rem);
            text-align: center;
            letter-spacing: 4px;
            border-bottom: 2px solid var(--gold);
            margin-bottom: 8px;
            display: table;
            margin-left: auto;
            margin-right: auto;
            padding-bottom: 5px;
        }

        .subtitle {
            text-align: center;
            font-family: 'Cinzel', serif;
            font-size: 0.75rem;
            color: var(--gold);
            margin-bottom: 25px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .cipher-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .menorah-group { text-align: center; }
        .row { display: flex; justify-content: space-between; padding: 0 2px; }
        .char-unit { display: flex; flex-direction: column; align-items: center; width: 18px; }
        .letter { font-weight: 600; font-size: 0.85rem; }
        .num { color: var(--gold); font-family: 'Cinzel', serif; font-size: 0.9rem; margin-top: 1px; }

        .menorah-svg {
            width: 100%; height: 35px; stroke: var(--ink);
            stroke-width: 1; fill: none; opacity: 0.4;
        }

        .input-wrapper { margin: 15px 0; text-align: center; }
        input {
            width: 95%; background: transparent; border: none;
            border-bottom: 1.5px solid var(--gold);
            font-size: clamp(1.5rem, 6vw, 2rem);
            text-align: center; font-family: 'Cinzel', serif;
            padding: 8px; outline: none; color: var(--ink);
        }

        .result-display { text-align: center; margin: 10px 0; }
        #totalValue {
            font-family: 'Cinzel', serif;
            font-size: clamp(3rem, 15vw, 6rem); 
            line-height: 1; margin: 5px 0;
            text-shadow: 2px 2px 0px var(--parchment), 4px 4px 0px rgba(184, 134, 11, 0.1);
            transition: transform 0.1s ease-out;
            display: inline-block;
        }

        #breakdown {
            margin-top: 5px; font-size: 0.8rem; color: #777;
            min-height: 1.2em; max-width: 90%; margin-left: auto;
            margin-right: auto; overflow-wrap: break-word;
        }

        .btn-group { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
        button {
            background: var(--ink); color: var(--parchment);
            border: 1px solid var(--ink); padding: 8px 20px;
            font-family: 'Cinzel', serif; cursor: pointer;
            transition: 0.3s; font-size: 0.75rem; letter-spacing: 1px;
        }
        button:hover { background: transparent; color: var(--ink); }

        footer { margin-top: 20px; font-size: 0.7rem; color: #aaa; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="content-wrap">
        <h1>Gematria The Cipher</h1>
        <p class="subtitle">Sacred Mathematical Harmony</p>

        <div class="cipher-grid">
            <div class="menorah-group">
                <div class="row">
                    <div class="char-unit"><span>A</span><span class="num">1</span></div>
                    <div class="char-unit"><span>B</span><span class="num">2</span></div>
                    <div class="char-unit"><span>C</span><span class="num">3</span></div>
                    <div class="char-unit"><span>D</span><span class="num">4</span></div>
                    <div class="char-unit"><span>E</span><span class="num">5</span></div>
                    <div class="char-unit"><span>F</span><span class="num">6</span></div>
                    <div class="char-unit" style="color:var(--gold)"><span>G</span><span class="num">7</span></div>
                    <div class="char-unit"><span>H</span><span class="num">6</span></div>
                    <div class="char-unit"><span>I</span><span class="num">5</span></div>
                    <div class="char-unit"><span>J</span><span class="num">4</span></div>
                    <div class="char-unit"><span>K</span><span class="num">3</span></div>
                    <div class="char-unit"><span>L</span><span class="num">2</span></div>
                    <div class="char-unit"><span>M</span><span class="num">1</span></div>
                </div>
                <svg class="menorah-svg" viewBox="0 0 300 60">
                    <path d="M10,0 Q150,110 290,0" /><path d="M35,0 Q150,85 265,0" /><path d="M60,0 Q150,65 240,0" />
                    <line x1="150" y1="0" x2="150" y2="60" stroke-width="2" />
                </svg>
            </div>

            <div class="menorah-group">
                <div class="row">
                    <div class="char-unit"><span>N</span><span class="num">1</span></div>
                    <div class="char-unit"><span>O</span><span class="num">2</span></div>
                    <div class="char-unit"><span>P</span><span class="num">3</span></div>
                    <div class="char-unit"><span>Q</span><span class="num">4</span></div>
                    <div class="char-unit"><span>R</span><span class="num">5</span></div>
                    <div class="char-unit"><span>S</span><span class="num">6</span></div>
                    <div class="char-unit" style="color:var(--gold)"><span>T</span><span class="num">7</span></div>
                    <div class="char-unit"><span>U</span><span class="num">6</span></div>
                    <div class="char-unit"><span>V</span><span class="num">5</span></div>
                    <div class="char-unit"><span>W</span><span class="num">4</span></div>
                    <div class="char-unit"><span>X</span><span class="num">3</span></div>
                    <div class="char-unit"><span>Y</span><span class="num">2</span></div>
                    <div class="char-unit"><span>Z</span><span class="num">1</span></div>
                </div>
                <svg class="menorah-svg" viewBox="0 0 300 60">
                    <path d="M10,0 Q150,110 290,0" /><path d="M35,0 Q150,85 265,0" /><path d="M60,0 Q150,65 240,0" />
                    <line x1="150" y1="0" x2="150" y2="60" stroke-width="2" />
                </svg>
            </div>
        </div>

        <div class="input-wrapper">
            <input type="text" id="userInput" placeholder="TYPE WORDS" autocomplete="off" oninput="handleInput()">
        </div>

        <div class="result-display">
            <p id="totalValue">0</p>
            <div id="breakdown">Giai điệu của toán học...</div>
        </div>

        <div class="btn-group">
            <button onclick="saveWork()">Seal (Lưu)</button>
            <button onclick="loadWork()">Recall (Mở)</button>
        </div>
    </div>
</div>


</footer>

<script>
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioCtx = null;

    const cipher = {
        'A':1, 'B':2, 'C':3, 'D':4, 'E':5, 'F':6, 'G':7, 'H':6, 'I':5, 'J':4, 'K':3, 'L':2, 'M':1,
        'N':1, 'O':2, 'P':3, 'Q':4, 'R':5, 'S':6, 'T':7, 'U':6, 'V':5, 'W':4, 'X':3, 'Y':2, 'Z':1
    };

    // Chuỗi tần số yêu cầu
    const tones = [527, 612, 758];
    let toneIndex = 0;

    function initAudio() {
        if (!audioCtx) audioCtx = new AudioContext();
        if (audioCtx.state === 'suspended') audioCtx.resume();
    }

    function playNextTone() {
        initAudio();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        const freq = tones[toneIndex % tones.length];
        toneIndex++;
        osc.type = 'sine';
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.4);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.4);
    }

    function playDeleteSound() {
        initAudio();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(482, audioCtx.currentTime); // Tần số xóa 482Hz
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.2);
    }

    let lastLength = 0;

    function handleInput() {
        const input = document.getElementById('userInput');
        const str = input.value.toUpperCase();
        
        if (str.length > lastLength) {
            const lastChar = str.charAt(str.length - 1);
            // Phát âm thanh gõ nếu là chữ hoặc số
            if (cipher[lastChar] || !isNaN(parseInt(lastChar))) {
                playNextTone();
            }
        } else if (str.length < lastLength) {
            playDeleteSound();
        }
        
        lastLength = str.length;
        calculate(str);
    }

    function calculate(str) {
        let total = 0;
        let details = [];
        
        // Regex tìm chữ cái hoặc cụm số liên tiếp
        const matches = str.match(/[A-Z]|[\d]+/g);

        if (matches) {
            matches.forEach(part => {
                if (cipher[part]) {
                    total += cipher[part];
                    details.push(cipher[part]);
                } else if (!isNaN(parseInt(part))) {
                    const numVal = parseInt(part);
                    total += numVal;
                    details.push(numVal);
                }
            });
        }
        
        const totalEl = document.getElementById('totalValue');
        totalEl.innerText = total;
        
        // Hiệu ứng nảy nhẹ khi số thay đổi
        totalEl.style.transform = "scale(1.05)";
        setTimeout(() => totalEl.style.transform = "scale(1)", 50);

        document.getElementById('breakdown').innerText = details.length > 0 ? details.join(" + ") : "Giai điệu của toán học...";
    }

    function saveWork() {
        localStorage.setItem('gematria_cipher_vibration', document.getElementById('userInput').value);
        alert("Seal: Dữ liệu đã được phong ấn.");
    }

    function loadWork() {
        const saved = localStorage.getItem('gematria_cipher_vibration');
        if (saved) {
            document.getElementById('userInput').value = saved;
            lastLength = saved.length;
            calculate(saved.toUpperCase());
        }
    }
</script>

</body>
</html>